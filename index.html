<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ØªÙ…ÙˆØ± Ø£Ù†Ø³ â€” Ø³ÙƒØ±ÙŠ Ù…Ù„ÙƒÙŠ</title>
<meta name="theme-color" content="#7a4b2f">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--bg:#faf6f2;--ink:#1c140e;--muted:#6b5b51;--card:#fff;--brand:#7a4b2f;--line:#efe7e1;--accent:#2e7d32}
  *{box-sizing:border-box} html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:"Cairo",system-ui}
  .wrap{min-height:100%;display:flex;flex-direction:column}
  header{background:linear-gradient(180deg,#f6eee7,#efe7e1);border-bottom:1px solid var(--line)}
  .container{max-width:920px;margin:0 auto;padding:16px}
  .brand{display:flex;gap:10px;align-items:center}
  .logo{font-size:32px} h1{margin:0;color:var(--brand);font-size:22px}
  .sub{color:var(--muted);font-size:14px;margin:2px 0 14px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(122,75,47,.06)}
  .row{display:grid;gap:10px} .grid2{display:grid;gap:10px;grid-template-columns:1fr 1fr}
  label{font-size:13px;color:var(--muted)}
  input,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid var(--line);background:#fff;color:var(--ink);font:inherit}
  textarea{min-height:88px;resize:vertical}
  .totals{display:flex;justify-content:space-between;gap:10px;padding:10px 12px;border:1px dashed #b5804f;border-radius:10px;background:#fff6ee;font-weight:700}
  .hint{font-size:12px;color:var(--muted)}
  .btn{appearance:none;border:none;border-radius:12px;padding:12px 16px;cursor:pointer;font-weight:700;color:#fff;background:linear-gradient(180deg,var(--brand),#5f3723);box-shadow:0 6px 14px rgba(122,75,47,.2)}
  .btn.secondary{background:linear-gradient(180deg,#2e7d32,#1b5e20)}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .status{margin-top:10px;font-size:14px}
  @media (max-width:780px){.grid2{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="container">
      <div class="brand">
        <div class="logo">ğŸŒ´</div>
        <div>
          <h1>ØªÙ…ÙˆØ± Ø£Ù†Ø³ â€” Ø³ÙƒØ±ÙŠ Ù…Ù„ÙƒÙŠ</h1>
          <div class="sub">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±ÙŠØ§Ø¶ â€” ØªÙˆØµÙŠÙ„ Ù„Ù„Ø¨ÙŠØª</div>
        </div>
      </div>
      <div class="card">
        <form id="orderForm" class="row" novalidate>
          <div class="grid2">
            <div>
              <label>Ø§Ù„Ù…Ù†ØªØ¬</label>
              <input value="Ø³ÙƒØ±ÙŠ Ù…Ù„ÙƒÙŠ" readonly>
            </div>
            <div>
              <label for="qty">Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØ±Ø§ØªÙŠÙ†</label>
              <input id="qty" type="number" min="1" step="1" value="1" required>
            </div>
          </div>

          <div>
            <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
            <input value="Ø§Ù„Ø±ÙŠØ§Ø¶" readonly>
          </div>
          <div>
            <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ…</label>
            <input value="ØªÙˆØµÙŠÙ„ Ù„Ù„Ø¨ÙŠØª" readonly>
          </div>

          <div class="totals">
            <div>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">â€”</span> Ø±.Ø³</div>
            <div class="hint" id="shipNote">Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ 15 Ø±.Ø³ â€” Ù…Ø¬Ø§Ù†Ù‹Ø§ Ù…Ù† 6 ÙƒØ±Ø§ØªÙŠÙ†</div>
          </div>

          <div class="grid2">
            <div>
              <label for="name">Ø§Ù„Ø§Ø³Ù…</label>
              <input id="name" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required>
            </div>
            <div>
              <label for="phone">Ø§Ù„Ø¬ÙˆØ§Ù„</label>
              <input id="phone" placeholder="05XXXXXXXX" pattern="^(\+966|00966|0)?5\d{8}$" required>
            </div>
          </div>

          <label for="address">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ (Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±ÙŠØ§Ø¶)</label>
          <textarea id="address" placeholder="Ø§Ù„Ø­ÙŠØŒ Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ø¨ÙŠØª Ø£Ùˆ Ø¹Ù„Ø§Ù…Ø© ÙØ§Ø±Ù‚Ø©" required></textarea>

          <div class="grid2">
            <button type="button" id="locBtn" class="btn secondary">ğŸ“ Ø§Ø³ØªØ®Ø¯Ù…ÙŠ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
            <input id="location" readonly placeholder="Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
          </div>

          <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <textarea id="notes" placeholder="ÙˆÙ‚Øª Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„ØªØ³Ù„ÙŠÙ…ØŒ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©â€¦"></textarea>

          <button class="btn" id="submitBtn" type="submit">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
          <div id="status" class="status hint"></div>
        </form>
      </div>
    </div>
  </header>
</div>

<script>
/* ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ ===== */
const PRICE_PER_CARTON = 75;     // Ø³Ø¹Ø± Ø³ÙƒØ±ÙŠ Ù…Ù„ÙƒÙŠ Ù„Ù„ÙƒØ±ØªÙˆÙ† (Ø±.Ø³)
const SHIPPING_FEE = 15;         // Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±ÙŠØ§Ø¶
const FREE_SHIP_THRESHOLD = 6;   // Ù…Ù† 6 ÙƒØ±Ø§ØªÙŠÙ† ÙØ£ÙƒØ«Ø± Ø§Ù„Ø´Ø­Ù† Ù…Ø¬Ø§Ù†Ù‹Ø§
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbykQmWaU6lSWzTarktTY2XfCW0ccmjbF0rHD6_B6jL6Q4btYnfwWZTdnBb8kCUYRnbC/exec"; // <<â€” Ø­Ø· Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ù‡Ù†Ø§
/* ================================= */

const qtyEl = document.getElementById('qty');
const totalEl = document.getElementById('total');
const shipNote = document.getElementById('shipNote');
const statusEl = document.getElementById('status');
const submitBtn = document.getElementById('submitBtn');

function num(v){ return Number(v)||0; }
function shippingFor(qty){ return qty >= FREE_SHIP_THRESHOLD ? 0 : SHIPPING_FEE; }
function calc(){
  const q = Math.max(1, num(qtyEl.value));
  const total = PRICE_PER_CARTON * q + shippingFor(q);
  totalEl.textContent = total.toLocaleString('ar-SA');
  shipNote.textContent = q >= FREE_SHIP_THRESHOLD ? 'Ø§Ù„Ø´Ø­Ù† Ù…Ø¬Ø§Ù†Ù‹Ø§ ğŸ‰' : `Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ ${SHIPPING_FEE} Ø±.Ø³ â€” Ù…Ø¬Ø§Ù†Ù‹Ø§ Ù…Ù† ${FREE_SHIP_THRESHOLD} ÙƒØ±Ø§ØªÙŠÙ†`;
}
qtyEl.addEventListener('input', calc); calc();

// ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) â€” ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ https (GitHub Pages Ø¢Ù…Ù†)
document.getElementById('locBtn').addEventListener('click', () => {
  const loc = document.getElementById('location');
  if (!navigator.geolocation) return alert('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹');
  const btn = document.getElementById('locBtn');
  btn.disabled = true; btn.textContent = 'Ø¬Ø§Ø±Ù ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹â€¦';
  navigator.geolocation.getCurrentPosition(pos=>{
    const {latitude, longitude} = pos.coords;
    loc.value = `${latitude.toFixed(6)},${longitude.toFixed(6)}`;
    btn.textContent = 'ğŸ“ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª'; btn.disabled = false;
  }, _=>{
    alert('ØªØ¹Ø°Ù‘Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹.');
    btn.textContent = 'ğŸ“ Ø§Ø³ØªØ®Ø¯Ù…ÙŠ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ'; btn.disabled = false;
  }, {enableHighAccuracy:true,timeout:10000,maximumAge:0});
});

// Ø¥Ø±Ø³Ø§Ù„ Ø¢Ù…Ù† Ø¥Ù„Ù‰ Google Apps Script (ØªØ®Ø²ÙŠÙ† Ø³Ø±Ù‘ÙŠØŒ Ø¨Ø¯ÙˆÙ† ÙˆØ§ØªØ³Ø§Ø¨)
document.getElementById('orderForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  statusEl.textContent = '';

  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const address = document.getElementById('address').value.trim();
  const location = document.getElementById('location').value.trim();
  const notes = document.getElementById('notes').value.trim();
  const qty = Math.max(1, num(qtyEl.value));
  const total = PRICE_PER_CARTON*qty + shippingFor(qty);

  if(!name){ alert('Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨'); return; }
  if(!/^(\+966|00966|0)?5\d{8}$/.test(phone)){ alert('Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ØºÙŠØ± ØµØ­ÙŠØ­ (05XXXXXXXX)'); return; }
  if(!address){ alert('Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±ÙŠØ§Ø¶'); return; }

  submitBtn.disabled = true; submitBtn.textContent = 'Ø¬Ø§Ø±Ù Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨â€¦';

  try{
    const res = await fetch(SCRIPT_URL, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        product: 'Ø³ÙƒØ±ÙŠ Ù…Ù„ÙƒÙŠ',
        price_per_carton: PRICE_PER_CARTON,
        qty, city:'Ø§Ù„Ø±ÙŠØ§Ø¶', delivery:'ØªÙˆØµÙŠÙ„ Ù„Ù„Ø¨ÙŠØª',
        shipping_fee: shippingFor(qty),
        total,
        name, phone, address, notes, location
      })
    });
    const data = await res.json().catch(()=> ({}));
    if(res.ok && data.status === 'ok'){
      statusEl.textContent = 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ… Ø¨Ù†Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø·Ù„Ø¨ ÙˆÙ†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªØ£ÙƒÙŠØ¯.';
      // ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: Ø­ÙØ¸ Ø¨Ø¹Ø¶ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ù„ØªØ¬Ø±Ø¨Ø© Ø±Ø¬ÙˆØ¹ Ø£Ù„Ø·Ù
      try{ localStorage.setItem('dates:name',name); localStorage.setItem('dates:phone',phone); localStorage.setItem('dates:addr',address); }catch{}
      // ØªÙØ±ÙŠØº Ø§Ù„ÙƒÙ…ÙŠØ§Øª ÙÙ‚Ø·
      // document.getElementById('orderForm').reset(); // Ù„Ùˆ ØªØ¨ÙŠ ØªÙØ±Ù‘Øº Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙƒÙ„Ù‡
    }else{
      throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸');
    }
  }catch(err){
    statusEl.textContent = 'ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø­Ø§Ù„ÙŠÙ‹Ø§. Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø£Ùˆ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©.';
  }finally{
    submitBtn.disabled = false; submitBtn.textContent = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨';
  }
});

// ØªØ¹Ø¨Ø¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
window.addEventListener('load', ()=>{
  try{
    document.getElementById('name').value = localStorage.getItem('dates:name') || '';
    document.getElementById('phone').value = localStorage.getItem('dates:phone') || '';
    document.getElementById('address').value = localStorage.getItem('dates:addr') || '';
  }catch{}
});
</script>
</body>
</html>
